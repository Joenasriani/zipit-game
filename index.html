<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ZIP IT!</title>
    <script src="https://cdn.tailwindcss.com/"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        body {
            background-color: rgb(248, 250, 255);
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            touch-action: none;
            user-select: none;
            overflow: hidden;
        }
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-8px); }
            75% { transform: translateX(8px); }
        }
        @keyframes zipPop {
            0% { transform: scale(0.8); opacity: 0; }
            100% { transform: scale(1); opacity: 1; }
        }
        .shake-board { animation: shake 0.2s ease-in-out 3; border-color: rgb(239, 68, 68) !important; }
        .flash-red { background-color: rgba(239, 68, 68, 0.1) !important; }
        .animate-zip-pop { animation: zipPop 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        const LEVELS = [
            { size: 6, nodes: { "0,0": 1, "0,5": 2, "5,5": 3, "5,4": 4 } },
            { size: 6, nodes: { "0,0": 1, "2,1": 2, "4,2": 3, "5,4": 4, "4,5": 5 } }, 
            { size: 6, nodes: { "1,1": 1, "4,1": 2, "4,4": 3, "1,4": 4, "0,5": 5 } },
            { size: 6, nodes: { "0,0": 1, "0,2": 2, "2,2": 3, "2,1": 4, "5,4": 5 } },
            { size: 6, nodes: { "0,0": 1, "1,1": 2, "2,2": 3, "3,3": 4, "5,4": 5 } },
            { size: 6, nodes: { "0,0": 1, "5,5": 2, "0,1": 3, "5,2": 4 } },
            { size: 6, nodes: { "0,0": 1, "1,1": 2, "2,2": 3, "3,3": 4, "4,4": 5, "5,5": 6, "5,4": 7 } },
            { size: 6, nodes: { "0,0": 1, "5,5": 2, "0,5": 3, "5,0": 4, "2,2": 5, "3,2": 6, "5,2": 7 } },
            { size: 6, nodes: { "0,0": 1, "0,5": 4, "5,5": 3, "5,0": 2, "2,2": 5, "2,3": 6, "1,4": 7 } },
            { size: 6, nodes: { "1,1": 1, "2,2": 2, "3,3": 3, "4,4": 4, "1,4": 5, "4,1": 6, "0,1": 7, "5,4": 8 } },
            { size: 6, nodes: { "1,1": 1, "1,4": 7, "2,2": 2, "2,3": 8, "3,2": 11, "3,3": 9, "4,1": 12, "4,4": 6, "5,0": 10, "5,1": 5, "0,5": 13 } },
            { size: 6, nodes: { "0,0": 1, "0,1": 2, "0,2": 3, "0,3": 4, "0,4": 5, "0,5": 6, "5,5": 7, "5,4": 8, "4,5": 9 } },
            { size: 6, nodes: { "1,1": 1, "1,2": 2, "2,2": 3, "2,1": 4, "3,1": 5, "3,2": 6, "4,2": 7, "4,1": 8, "5,0": 9, "5,2": 10 } },
            { size: 6, nodes: { "0,0": 1, "5,0": 2, "5,5": 3, "0,5": 4, "3,3": 5, "2,2": 6, "1,1": 7, "4,3": 8, "5,4": 9 } },
            { size: 6, nodes: { "0,0": 1, "3,0": 2, "3,3": 3, "0,3": 4, "0,5": 5, "5,5": 6, "5,0": 7, "2,2": 8, "4,5": 9, "5,4": 10 } },
            { size: 6, nodes: { "1,1": 1, "1,4": 2, "4,4": 3, "4,1": 4, "2,2": 5, "2,3": 6, "3,3": 7, "3,2": 8, "0,0": 9, "5,4": 10, "0,5": 11 } },
            { size: 6, nodes: { "0,0": 1, "0,5": 2, "1,5": 3, "1,0": 4, "2,0": 5, "2,5": 6, "3,5": 7, "3,0": 8, "4,0": 9, "4,5": 10, "5,4": 11 } },
            { size: 6, nodes: { "0,0": 1, "1,1": 3, "0,1": 2, "1,0": 4, "2,0": 5, "2,1": 6, "3,1": 7, "3,0": 8, "5,0": 9, "5,5": 10, "0,3": 11, "5,4": 12 } },
            { size: 6, nodes: { "0,0": 1, "2,0": 2, "2,2": 3, "0,2": 4, "0,4": 5, "2,4": 6, "4,4": 7, "4,2": 8, "4,0": 9, "5,5": 10, "3,2": 11, "5,4": 12 } },
            { size: 6, nodes: { "1,1": 1, "1,3": 2, "3,3": 3, "3,1": 4, "5,1": 5, "5,3": 6, "5,5": 7, "0,0": 8, "0,5": 9, "2,5": 10, "4,5": 11, "4,1": 12, "0,3": 13 } },
            { size: 6, nodes: { "0,0": 1, "0,1": 2, "1,1": 3, "1,0": 4, "2,0": 5, "2,1": 6, "3,1": 7, "3,0": 8, "4,0": 9, "4,1": 10, "5,1": 11, "5,0": 12, "5,3": 13, "0,5": 14 } },
            { size: 6, nodes: { "0,0": 1, "1,0": 2, "1,1": 3, "0,1": 4, "0,2": 5, "1,2": 6, "1,3": 7, "0,3": 8, "0,4": 9, "1,4": 10, "1,5": 11, "0,5": 12, "5,5": 13, "5,4": 14, "4,5": 15 } },
            { size: 6, nodes: { "3,3": 1, "2,2": 2, "1,1": 3, "0,0": 4, "0,5": 5, "5,5": 6, "5,0": 7, "4,1": 8, "3,2": 9, "2,3": 10, "1,4": 11, "2,5": 12, "4,3": 13, "5,4": 14 } },
            { size: 6, nodes: { "0,0": 1, "2,0": 2, "4,0": 3, "5,1": 4, "5,3": 5, "5,5": 6, "3,5": 7, "1,5": 8, "0,4": 9, "0,2": 10, "2,2": 11, "2,4": 12, "3,3": 13, "4,3": 14, "5,4": 15 } },
            { size: 6, nodes: { "0,0": 1, "0,2": 2, "0,4": 3, "2,4": 4, "4,4": 5, "4,2": 6, "4,0": 7, "2,0": 8, "2,2": 9, "1,1": 10, "1,3": 11, "3,3": 12, "3,1": 13, "5,5": 14, "5,0": 15, "5,2": 16 } }, 
            { size: 6, nodes: { "0,0": 1, "1,0": 2, "1,1": 3, "0,1": 4, "0,2": 5, "1,2": 6, "2,2": 7, "2,1": 8, "2,0": 9, "3,0": 10, "3,1": 11, "3,2": 12, "4,2": 13, "4,1": 14, "4,0": 15, "5,0": 16, "5,4": 17 } }, 
            { size: 6, nodes: { "0,0": 1, "0,1": 2, "1,1": 3, "1,0": 4, "2,0": 5, "2,1": 6, "3,1": 7, "3,0": 8, "4,0": 9, "4,1": 10, "5,1": 11, "5,0": 12, "5,2": 13, "4,2": 14, "3,2": 15, "2,2": 16, "1,2": 17, "0,5": 18 } },
            { size: 6, nodes: { "0,0": 1, "1,0": 2, "2,0": 3, "3,0": 4, "4,0": 5, "5,0": 6, "5,1": 7, "4,1": 8, "3,1": 9, "2,1": 10, "1,1": 11, "0,1": 12, "0,2": 13, "1,2": 14, "2,2": 15, "3,2": 16, "4,2": 17, "5,2": 18, "5,4": 19 } }, 
            { size: 6, nodes: { "0,0": 1, "1,0": 2, "1,1": 3, "0,1": 4, "0,2": 5, "1,2": 6, "2,2": 7, "2,1": 8, "2,0": 9, "3,0": 10, "3,1": 11, "3,2": 12, "4,2": 13, "4,1": 14, "4,0": 15, "5,0": 16, "5,1": 17, "5,2": 18, "5,3": 19, "5,4": 20, "0,5": 21 } },
            { size: 6, nodes: { "0,0": 1, "1,0": 2, "1,1": 3, "0,1": 4, "0,2": 5, "1,2": 6, "2,2": 7, "2,1": 8, "2,0": 9, "3,0": 10, "3,1": 11, "3,2": 12, "4,2": 13, "4,1": 14, "4,0": 15, "5,0": 16, "5,1": 17, "5,2": 18, "5,3": 19, "4,3": 20, "5,4": 21 } }
        ];

        const COMP_MESSAGES = [
            "So… you know how to zip it.", "SO YOU THINK YOU ARE 50% BETTER THAN ANY OTHER CEO?", 
            "Clean start.", "Nice.", "That counts.", 
            "Okay, that was clean.", "You’re getting it.", "Not bad at all.", "Nice. Don’t get comfortable.", "You’re warming up. Joe noticed.",
            "That wasn’t accidental.", "You’re thinking ahead now.", "Most people mess this up.", "Feeling confident yet?", "That path had intent.",
            "Okay… that was smart.", "You saw the trap.", "Logic over luck. Good choice.", "You’re not guessing anymore.", "That filtered the amateurs.",
            "Feeling smarter than the average CEO?", "This is where people slip.", "You’re playing this correctly.", "Careful. You’re getting good.", "That move earns respect.",
            "Alright. That was elite.", "You’re thinking like the designer.", "This level breaks confidence.", 
            "You didn’t just zip it — you solved it."
        ];

        function App() {
            const [levelIdx, setLevelIdx] = useState(0);
            const [path, setPath] = useState([]);
            const [isDragging, setIsDragging] = useState(false);
            const [win, setWin] = useState(false);
            const [errorCell, setErrorCell] = useState(null);
            const [isMusicOn, setIsMusicOn] = useState(false);
            const [shake, setShake] = useState(false);
            const canvasRef = useRef(null);
            const gridRef = useRef(null);
            const audioRef = useRef(null);

            const currentLevel = LEVELS[levelIdx];
            const maxVal = Math.max(...Object.values(currentLevel.nodes));

            useEffect(() => {
                if (!audioRef.current) {
                    audioRef.current = new Audio('https://robomarket.ae/music/zipit.mp3');
                    audioRef.current.loop = true;
                }
                if (isMusicOn) audioRef.current.play().catch(() => {});
                else audioRef.current.pause();
            }, [isMusicOn]);

            const drawPath = () => {
                const canvas = canvasRef.current;
                if (!canvas || !gridRef.current) return;
                const ctx = canvas.getContext('2d');
                const rect = gridRef.current.getBoundingClientRect();
                const dpr = window.devicePixelRatio || 1;

                canvas.width = rect.width * dpr;
                canvas.height = rect.height * dpr;
                ctx.scale(dpr, dpr);
                ctx.clearRect(0, 0, rect.width, rect.height);

                if (path.length < 1) return;
                const cellSize = rect.width / currentLevel.size;
                const half = cellSize / 2;

                ctx.beginPath();
                ctx.strokeStyle = 'rgb(230, 138, 62)'; 
                ctx.lineWidth = cellSize * 0.75; 
                ctx.lineCap = 'round';
                ctx.lineJoin = 'round';

                path.forEach((pos, i) => {
                    const x = pos.c * cellSize + half;
                    const y = pos.r * cellSize + half;
                    if (i === 0) ctx.moveTo(x, y);
                    else ctx.lineTo(x, y);
                });
                ctx.stroke();
            };

            useEffect(() => {
                drawPath();
                window.addEventListener('resize', drawPath);
                return () => window.removeEventListener('resize', drawPath);
            }, [path, levelIdx]);

            const getCoords = (clientX, clientY) => {
                if (!gridRef.current) return null;
                const rect = gridRef.current.getBoundingClientRect();
                const x = clientX - rect.left;
                const y = clientY - rect.top;
                if (x < 0 || x > rect.width || y < 0 || y > rect.height) return null;
                const c = Math.floor((x / rect.width) * currentLevel.size);
                const r = Math.floor((y / rect.height) * currentLevel.size);
                return { r, c };
            };

            const handlePointerDown = (e) => {
                if (win) return;
                const coords = getCoords(e.clientX, e.clientY);
                if (!coords) return;
                const key = `${coords.r},${coords.c}`;
                if (path.length === 0) {
                    if (currentLevel.nodes[key] === 1) {
                        setPath([coords]);
                        setIsDragging(true);
                    }
                } else {
                    const idx = path.findIndex(p => p.r === coords.r && p.c === coords.c);
                    if (idx !== -1) {
                        setPath(path.slice(0, idx + 1));
                        setIsDragging(true);
                    }
                }
            };

            const handlePointerMove = (e) => {
                if (!isDragging || win) return;
                const coords = getCoords(e.clientX, e.clientY);
                if (!coords) return;
                const head = path[path.length -  head.r === coords.r && head.c === coords.c) return;
                
                const headNode = path[path.length - 1];
                if (Math.abs(coords.r - headNode.r) + Math.abs(coords.c - headNode.c) === 1) {
                    if (path.length > 1) {
                        const prev = path[path.length - 2];
                        if (prev.r === coords.r && prev.c === coords.c) {
                            setPath(path.slice(0, -1));
                            return;
                        }
                    }
                    if (path.some(p => p.r === coords.r && p.c === coords.c)) return;
                    
                    const nodeVal = currentLevel.nodes[`${coords.r},${coords.c}`];
                    if (nodeVal) {
                        let last = 0;
                        for (let i = path.length - 1; i >= 0; i--) {
                            const v = currentLevel.nodes[`${path[i].r},${path[i].c}`];
                            if (v) { last = v; break; }
                        }
                        if (nodeVal !== last + 1) {
                            setErrorCell(coords);
                            setTimeout(() => setErrorCell(null), 250);
                            return;
                        }
                    }
                    const newPath = [...path, coords];
                    setPath(newPath);

                    const total = currentLevel.size * currentLevel.size;
                    const visited = newPath.filter(p => currentLevel.nodes[`${p.r},${p.c}`]).length;
                    const endVal = currentLevel.nodes[`${coords.r},${coords.c}`];

                    if (newPath.length === total && visited === Object.keys(currentLevel.nodes).length && endVal === maxVal) {
                        setWin(true);
                        setIsDragging(false);
                        setTimeout(() => {
                            if (levelIdx < LEVELS.length - 1) {
                                setLevelIdx(prev => prev + 1);
                                setPath([]);
                                setWin(false);
                            }
                        }, 3000);
                    } else if (endVal === maxVal) {
                        setShake(true);
                        setErrorCell(coords);
                        setTimeout(() => { setShake(false); setErrorCell(null); }, 600);
                    }
                }
            };

            const hardReset = () => {
                setLevelIdx(0);
                setPath([]);
                setWin(false);
            };

            return (
                <div className="flex flex-col items-center min-h-screen p-8 font-sans select-none touch-none">
                    <div className="w-full max-w-[500px] flex flex-col h-[95vh]">
                        <div className="flex justify-between items-center mb-10 w-full px-2">
                            <div className="flex items-center gap-6">
                                <i data-lucide="arrow-left" className="w-10 h-10 cursor-pointer text-gray-700" onClick={() => levelIdx > 0 && setLevelIdx(prev => prev - 1)}></i>
                                <div className="flex flex-col text-left">
                                    <div className="flex items-center gap-2 uppercase tracking-tighter">
                                        <span className="bg-blue-900 text-white px-2 py-1 rounded-lg text-4xl font-black" style={{backgroundColor: 'rgb(0, 65, 130)'}}>ZIP</span>
                                        <span className="text-5xl font-black text-gray-800">IT!</span>
                                    </div>
                                    <span className="text-[10px] text-gray-400 font-bold mt-1 ml-1 tracking-tight uppercase">LINKEDIN GAME PRACTICE</span>
                                </div>
                            </div>
                            <div className="flex gap-4 items-center">
                                <i data-lucide="refresh-cw" className="w-8 h-8 cursor-pointer text-gray-400 hover:text-gray-600" onClick={hardReset}></i>
                                <div onClick={() => setIsMusicOn(!isMusicOn)} className="cursor-pointer text-gray-700">
                                    {isMusicOn ? <i data-lucide="volume-2" className="w-8 h-8"></i> : <i data-lucide="volume-x" className="w-8 h-8"></i>}
                                </div>
                            </div>
                        </div>

                        <div className="flex justify-end mb-3 pr-2">
                            <button onClick={() => setPath([])} className="text-gray-500 font-bold bg-gray-200/60 px-6 py-1.5 rounded-full text-sm border border-gray-300">Clear</button>
                        </div>

                        <div className={`bg-white border-[4px] border-gray-300 rounded-[48px] p-2.5 shadow-md transition-all ${shake ? 'shake-board' : ''}`}>
                            <div ref={gridRef} onPointerDown={handlePointerDown} onPointerMove={handlePointerMove} onPointerUp={() => setIsDragging(false)} className="relative w-full overflow-hidden rounded-[40px]" style={{ aspectRatio: '1/1', display: 'grid', gridTemplateColumns: 'repeat(6, 1fr)', gridTemplateRows: 'repeat(6, 1fr)' }}>
                                <canvas ref={canvasRef} className="absolute inset-0 z-10 pointer-events-none" style={{ width: '100%', height: '100%' }} />
                                {Array.from({ length: 36 }).map((_, i) => {
                                    const r = Math.floor(i / 6), c = i % 6;
                                    const val = currentLevel.nodes[`${r},${c}`];
                                    const isInPath = path.some(p => p.r === r && p.c === c);
                                    const isError = errorCell?.r === r && errorCell?.c === c;
                                    const nodeBg = val ? (isInPath ? 'rgb(0, 65, 130)' : 'black') : 'transparent';
                                    const isMissed = shake && !isInPath;

                                    return (
                                        <div key={i} className={`relative flex items-center justify-center border-[0.5px] border-gray-200 transition-colors ${isMissed ? 'flash-red' : ''}`}>
                                            {val && (
                                                <div className={`w-[76%] h-[76%] rounded-full flex items-center justify-center font-bold text-xl z-20 transition-all text-white ${isError ? 'bg-red-500 scale-110' : ''}`} style={{backgroundColor: nodeBg}}>
                                                    {val}
                                                </div>
                                            )}
                                        </div>
                                    );
                                })}
                            </div>
                        </div>

                        <div className="mt-10 px-4 flex flex-col gap-4">
                            <button disabled={path.length < 2 || win} onClick={() => setPath(prev => prev.slice(0, -1))} className="w-full bg-gray-200 text-gray-500 font-bold py-4 rounded-full text-lg active:bg-gray-300 transition-colors">Undo</button>
                            <div className="bg-white border border-gray-200 rounded-xl p-5 flex justify-between items-center cursor-pointer">
                                <span className="text-gray-800 font-bold text-base">How to play</span>
                                <i data-lucide="chevron-down" className="text-gray-500 w-6 h-6"></i>
                            </div>
                        </div>

                        <div className="flex-grow"></div>
                        <div className="text-center mb-10 font-black text-gray-400 text-sm uppercase tracking-widest">Level {levelIdx + 1} of 30</div>
                    </div>

                    {win && (
                        <div className="fixed inset-0 z-50 flex items-center justify-center p-8 bg-white/40 backdrop-blur-[6px] transition-opacity duration-300 opacity-100">
                            <div className="bg-white rounded-[40px] p-12 text-center max-sm shadow-2xl border-4 border-[rgb(0,65,130)] animate-zip-pop">
                                <h2 className="text-7xl font-black text-[rgb(0,65,130)] mb-2 italic uppercase tracking-tighter">ZIPPED!</h2>
                                <p className="text-gray-600 font-black text-xl leading-snug whitespace-nowrap">{COMP_MESSAGES[levelIdx]}</p>
                            </div>
                        </div>
                    )}
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);

        // Initialize Lucide icons
        setTimeout(() => lucide.createIcons(), 500);
    </script>
</body>
</html>

